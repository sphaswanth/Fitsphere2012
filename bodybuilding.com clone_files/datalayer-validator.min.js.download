var dataLayerValidator=function(){"use strict";var e=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();var a=void 0,u=void 0,t=new Set(["product-detail","purchase","add-to-cart","checkout","productClick","product-impression","promotionClick","promotion-impression","remove-from-cart"]),r=function(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],o=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=arguments[2];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),a=e,u=t,this.cookies={},this.events=[],this.eventIndex=0,this.eventNames=new Set([]),this.dom=n,u.split(";").forEach(function(e){var t=e.split("="),n=t.shift(),r=t.join("=");o.cookies[n]=r});var r={};a.forEach(function(e){if(r=Object.assign(r,e),e.event){var t=e.event,n=Object.assign({},r);o.events.push(n),o.eventNames.add(t)}}),this.finalizedDataLayer=Object.assign({},r)}return e(i,[{key:"getFirstPageViewEvent",value:function(){var e=void 0,t=this.filterEvents(function(e){return"gtm.js"===e.event});return 0<t.length&&(e=t[0]),e||console.warn("validation-context: Default page view event is missing!"),e}},{key:"getSPAPageViews",value:function(){return this.filterEvents(function(e){return"pageview"===e.event})}},{key:"filterEvents",value:function(e){return this.events.filter(e)}},{key:"hasEvent",value:function(e){return this.eventNames.has(e)}},{key:"getEvent",value:function(e){return this.events[e]}},{key:"nextEvent",value:function(){return++this.eventIndex,this.getEvent(this.eventIndex)}},{key:"hasNextEvent",value:function(){return this.events.length>this.eventIndex+1}},{key:"getCookie",value:function(e,t){return this.cookies[e]||t}},{key:"hasCookie",value:function(e){return!!this.cookies[e]}},{key:"getEnhancedEcommerceEvents",value:function(){return this.filterEvents(function(e){return t.has(e.event)})}},{key:"getFinalizedDataLayer",value:function(){return Object.assign({},this.finalizedDataLayer)}},{key:"getDataLayerArray",value:function(){return a}},{key:"getPrivacySettings",value:function(){return this.getFirstPageViewEvent().privacySettings||{isEUCountry:!0,experience:!1,social:!1,necessary:!0,fallbackSource:"datalayer-validator"}}}]),i}(),o=void 0,c=function(e,t,n){return!(3<arguments.length&&void 0!==arguments[3]&&arguments[3])&&o||(o=new r(e,t,n)),o};var s=function e(t){var n=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.message=r||t.describe(),this.rule=t,Object.keys(o).forEach(function(e){n[e]||(n[e]=o[e])}),this.severity=o.severity||t.severity},l=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var v={failure:"failure",error:"error",skipped:"skipped"};function n(e,t){for(var n=e.split("."),r=t;0<n.length&&(r=r[n.shift()]););return r}var d=function(){function i(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:v.failure;h(this,i);var o=n?n+"."+e:e;this.context=n,this.name=e,this.fqn=o,this.category=t,this.severity=r}return l(i,[{key:"violated",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return new s(this,e,t)}},{key:"test",value:function(){this.violated("Rule "+this.name+" has no test!")}},{key:"describe",value:function(){return"Expect "+this.name+" is "+this.category+" on dataLayer"+(this.context?"."+this.context:"")}}]),i}(),i=function(e){function r(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:v.failure;return h(this,r),f(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,d.names.required,t,n))}return p(r,d),l(r,[{key:"test",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=!1;if(e[this.name])t=!0;else for(var n=this.fqn.split("."),r=e,o=0;o<n.length&&(r=r[n[o]]);o++)o===n.length-1&&(t=!0);if(!t)return this.violated("Property "+this.fqn+" is required!",{value:e[this.name]},{value:"null",expected:"Some[Any]"})}}]),r}();d.RequiredRule=i;var b=function(e){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Set,t=arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:v.failure;h(this,i);var o=f(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,d.names.knownKeys,n,r));return"Set"!==e.constructor.names&&(e=new Set(e)),o.knownKeys=e,o}return p(i,d),l(i,[{key:"test",value:function(e){if(!this.knownKeys.has(e[this.name]))return this.violated('Value "'+e[this.name]+'" for property '+this.fqn+" should be one of ["+Array.from(this.knownKeys).join(", ")+"]!",{value:e,expected:this.knownKeys})}},{key:"describe",value:function(){return"Expect "+this.fqn+" to be one of ["+Array.from(this.knownKeys).join(", ")+"]"}}]),i}();d.RestrictKeyRule=b;var y=function(e){function i(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:v.failure;h(this,i);var o=f(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,d.names.equals,n,r));return o.expected=e,o}return p(i,d),l(i,[{key:"test",value:function(e){var t=n(this.fqn,e);if(t!=this.expected)return this.violated(this.fqn+": Value '"+t+"' != '"+this.expected+"'")}}]),i}(),g=function(e){function i(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:v.failure;h(this,i);var o=f(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,d.names.equals,n,r));return o.expected=e,o}return p(i,d),l(i,[{key:"test",value:function(e){var t=n(this.fqn,e);if(t!==this.expected)return this.violated(this.fqn+": Value '"+t+"' !== '"+this.expected+"'")}}]),i}(),m=function(e){function i(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:v.failure;h(this,i);var o=f(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,d.names.equals,n,r));return o.expected=e,o}return p(i,d),l(i,[{key:"test",value:function(e){var t=n(this.fqn,e)||"";if("string"!=typeof t&&(t=t.toString()),!t.match(this.expected))return this.violated(this.fqn+": String '"+t+"' does not match pattern "+this.expected)}}]),i}();d.EqualsRule=y,d.StrictEqualsRule=g,d.StringMatchesRule=m,d.exception=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return e.stack&&(n.stack=e.stack.split("\n")),new d(e.constructor.name,d.names.exception,t,v.error).violated(e.message,n)},d.custom=function(r,n,o){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"",a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"error";return new(function(e){function t(){return h(this,t),f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n,o,i,a))}return p(t,d),l(t,[{key:"test",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.apply(this,t)}}]),t}())(n,o,i,a)},d.severities=v,d.names={required:"required",unknownKey:"unknown-key",exception:"exception",contradictingState:"contradicting-state",invalidType:"invalid-type",equals:"equals",stringMatches:"string-matches"};var w=function(e){function o(r,e,t){h(this,o);var n=f(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,"!"+r.name,r.category,r.context,r.severity));return n.descriptionProvider=t,n.validationMessageProvider=e,n.srcTest=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.test.apply(r,[].concat(t))},n.srcDescribe=function(){return r.describe()},n}return p(o,d),l(o,[{key:"test",value:function(){var e=void 0,t=this.srcTest.apply(this,arguments),n=!1;if(t&&t.severity===d.severities.skipped?n=!0:t||(n=!0),n){var r=void 0,o=t||{};r=this.validationMessageProvider?this.validationMessageProvider:t?"[NOT] "+t.message:this.describe(),e=this.violated(r,o)}return e}},{key:"describe",value:function(){return this.descriptionProvider?this.descriptionProvider:"[NOT] "+this.srcDescribe()}}]),o}();w.whenUserOptsOut=function(e,t,n,r){return c().getPrivacySettings()[e]?t:new w(t,n,r)},d.Not=w;var _=function(e){function t(e){return h(this,t),f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"cookie-required"))}return p(t,d),l(t,[{key:"test",value:function(){var t=void 0;try{c().hasCookie(this.name)||(t=this.violated("Cookie "+this.name+" is required!"))}catch(e){t=new s(this,"Cookie "+this.name+" cannot be read in this environment.",{severity:d.severities.skipped})}return t}},{key:"describe",value:function(){return"Expect that cookie "+this.name+" is present."}}]),t}();d.CookieRequiredRule=_;var O=d,P=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var j=function(){function o(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2],r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:function(){return!1};k(this,o),this.name=n,this.rules=t.slice(0),this.sourceObject=e,this._active="function"==typeof r?r:function(){return r}}return P(o,[{key:"validate",value:function(){var n=this,t=void 0;try{t=this.rules.map(function(t){try{return t.test(n.sourceObject)}catch(e){return O.exception(e,n.name,t)}}).filter(function(e){return!!e})}catch(e){console.error("Validator: %s%s failed. %s",this.constructor.name,this.name?"."+this.name:"",e.message,e),t=[O.exception(ex,this.name)]}return t.map(function(e){return e.message=(n.name||n.constructor.name)+": "+e.message,e})}},{key:"shouldBeApplied",value:function(){return this._active()}}]),o}();j.create=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"validator",r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:function(){return!1};return new j(e,t,n,r)};var E=function(e){function o(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return[]},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"chained-validator";k(this,o);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e,[],n));return r.validators=t(e).slice(0),r.rules=r.rules.concat(j.allActiveRules(r.validators)).slice(0),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,j),P(o,[{key:"validate",value:function(){var t=this,n=void 0;try{n=j.allViolations(this.validators)}catch(e){console.error("Validator: %s%s failed. %s",this.constructor.name,this.name?"."+this.name:"",ex.message,ex),n=[O.exception(ex,this.name)]}return n.map(function(e){return e.message=t.name+": "+e.message,e})}},{key:"addValidator",value:function(e){this.validators.push(e),this.rules=this.rules.concat(e.rules)}}]),o}();j.allViolations=function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).filter(function(e){return e.shouldBeApplied()}).map(function(e){return e.validate()}).reduce(function(e,t){return e.concat(t)},[])},j.allActiveRules=function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).filter(function(e){return e.shouldBeApplied()}).map(function(e){return e.rules.slice(0)}).reduce(function(e,t){return e.concat(t)},[])},j.ChainedValidator=E;var R=j,S=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();var x=["bbPageViewId","bbPageSiteSection","bbPageName","bbPageType","bbMetaEnvironment","bbWrapperVersion","bbServer.version","bbServer.name","bbClient.version","bbClient.name"].map(function(e){return new O.RequiredRule(e)}).concat([new O.RestrictKeyRule(new Set(["store","content","bodyspace","forum","search","settings","feedback","help"]),"bbPageSiteSection")]);var q=function(e){function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,c().getFirstPageViewEvent(),(e=c().getFirstPageViewEvent(),t=x,e.privacySettings&&(e.privacySettings.experience?t.push(new O.RequiredRule("bbUserMachineId")):(t.push(new O.Not(new O.RequiredRule("bbMetaOmnitureVisitorId"))),t.push(new O.Not(new O.RequiredRule("bbUserMachineId"))))),t)));var e,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,R),S(n,[{key:"shouldBeApplied",value:function(){return!0}}]),n}();var C=function(e){var t=e+"=",n=void 0,r="",o={},i=void 0,a=void 0;try{n=(window.document||{cookie:""}).cookie.split(";")}catch(e){return null}for(a=0;a<n.length;a++){for(i=n[a];" "==i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t)){if("{"==(r=decodeURIComponent(i.substring(t.length,i.length))).substring(0,1))try{if("v"in(o=JSON.parse(r)))return o.v}catch(e){return r}if("undefined"==r)return;return r}}return null},V=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();var T=new Set(["bbUserId","bbCommerceUserId","bbUserHomeCountry","bbUserHomeState","bbUserHomeCity","bbUserGoalsMain","bbUserGoalsBodyFat","bbUserGoalsPhysique","bbUserGender","bbUserMilitaryBranch","bbUserJoinDate","bbUserLastLogin","bbCommerceOrderCount","bbCommerceLastOrder"]),A=["bbUserLoginMethod","bbUserId","bbBodyspaceUserId","bbUserJoinDate","bbUserHomeCountry","bbUserHomeState","bbUserHomeCity","bbUserLastLogin"];function L(e){var t=this,n=e.getFinalizedDataLayer(),r=[O.custom(function(){!n.bbUserLoggedInStatus&&n.bbUserLoginMethod&&t.violated("Login method "+n.bbUserLoginMethod+" provided for user who is not logged in!",{value:n.bbUserLoginMethod,expected:"null"})},"bbUserLoginMethod",O.name.contradictingState),new O.StringMatchesRule(/^\w+-\w+-\w+-\w+-\w+$/,"bbUserMachineId")];return C("m")&&r.push(new O.StrictEqualsRule(C("m")||"","bbUserMachineId")),n.bbUserLoggedInStatus&&(e.getPrivacySettings().experience?A.forEach(function(e){return r.push(new O.RequiredRule(e))}):[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(T)).map(function(e){return new O.Not(new O.RequiredRule(e))}).concat(A.filter(function(e){return!T.has(e)})).forEach(function(e){e&&r.push(new O.RequiredRule(e))})),r}var N=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,L(c())))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,R),V(t,[{key:"shouldBeApplied",value:function(e){var t=void 0;try{t=!(!window.sessionStorage||!window.sessionStorage.getItem("bba.profile"))}catch(e){try{window.sessionStorage&&(console.warn("Running in non standard browser environment without sessionStorage. Cannot check if user props actually should be set!"),t=!0)}catch(e){console.warn("Running outside the browser. Cannot check if user props actually should be set!"),t=!0}}return t}}]),t}(),z=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),U=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0};function F(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function D(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function I(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var M=O.RequiredRule,B={averageRating:"dimension124",hasPromotion:"dimension125",sizeOption:"dimension126",sizeOptionLabel:"dimension127",servingSize:"dimension128",skuId:"dimension129",variantRating:"dimension130"},K=function(e){function r(e,t){F(this,r);var n=D(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,B[e],t));return n.dimensionName=e,n}return I(r,O.RequiredRule),z(r,[{key:"violated",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return U(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"violated",this).call(this,e+" ["+this.name+" = "+this.dimensionName+"]",t)}},{key:"describe",value:function(){return"Expect that "+this.name+" a.k.a. "+B[this.dimensionName]+" is present on "+this.fqn+"."}}]),r}(),Z=[/.*(lb|tons|oz|ounce|ounces).*/,/.*\b(kg|g|mg)\b.*/,/.*(amu|newton).*/,/.*(stone).*/],H=[/.*(small|sm).*/,/.*(medium|med).*/,/.*(large|lg).*/,/.*(xl|2xl|3xl|xs).*/,/.*(xlarge|x-large|xlg).*/,/.*(xxlarge|xx-large|xxlg).*/,/.*(xxxlarge|xxx-large|xxxlg).*/],G=function(e){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"*",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"n";return F(this,n),D(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"not.sizey","ecommerce","ecommerce."+e+".products["+t+"].variant",O.severities.failure))}return I(n,O),z(n,[{key:"test",value:function(e){for(var t=0;t<Z.length;t++)if(e.variant.toLowerCase().match(Z[t]))return this.violated('Product variant cannot contain weights !"'+e.variant+'" matched on pattern '+Z[t]+"!",{product:e,pattern:Z[t]});for(var n=0;n<H.length;n++)if(e.variant.toLowerCase().match(H[n]))return this.violated('Product variant cannot contain sizes !"'+e.variant+'" matched on pattern '+H[n]+" !",{product:e,pattern:H[n]})}},{key:"describe",value:function(){return"Expect product option "+this.fqn+" NOT to resemble a size. (size should be set in "+this.context+"."+B.sizeOption+")"}}]),n}(),Y=function(e){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"*",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"n";F(this,i);var r=D(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e,[],"ecommerce."+t+".products["+n+"]")),o="ecommerce."+t+".products["+n+"]";return r.rules=[new M("id",o),new M("name",o),new M("price",o),new M("brand",o),new M("category",o),new O.RestrictKeyRule(new Set(["SUPPLEMENT","CLOTHING","ACCESSORY","MEDIA","COMBO"]),"category",o),new K("skuId",o)],e.variant&&r.rules.push(new G(t,n)),r}return I(i,R),z(i,[{key:"shouldBeApplied",value:function(){return!0}},{key:"validate",value:function(){return U(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"validate",this).call(this)}}]),i}(),J=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();var W=function(e){function n(o,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{eventNames:new Set,requiredProps:new Set};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,function(){var r=[];0<i.eventNames.size&&r.push(new O.RestrictKeyRule(i.eventNames,"event"));!function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Set,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"ecommerce."+o;e.forEach(function(e){r.push(new O.RequiredRule(e,""+n)),i[e]&&i[e].requiredProps&&t(i[e].requiredProps,n+"."+e)})}(i.requiredProps);var n=[],e=R.create(t,r,"ecommerce."+o+".core",function(){return!!(t.ecommerce&&t.ecommerce[o])});return n.push(e),i.requiredProps.has("products")&&t.ecommerce&&t.ecommerce[o]&&(t.ecommerce[o].products||[]).forEach(function(e,t){n.push(new Y(e,o,t))}),n},o));return e.config=Object.assign({},i),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,R.ChainedValidator),J(n,[{key:"shouldBeApplied",value:function(){return!!(this.sourceObject.ecommerce&&this.sourceObject.ecommerce[this.name])}},{key:"validate",value:function(){return function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0}(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"validate",this).call(this)}}]),n}(),$=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function Q(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function X(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ee(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function te(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var ne=["header","page-content","footer"],re=["body"],oe=["top-nav","top-help-bar","top-dynamic","breadcrumbs","heading","left-rail","right-rail","body","ad","header"],ie=function(e){function r(e,t){X(this,r);var n=ee(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,"DOM"));return n.zoneLevel=e,n}return te(r,O),$(r,[{key:"test",value:function(){var t=this;if([].concat(Q(c().dom.querySelectorAll("[data-bb-zone"+this.zoneLevel+"]"))).filter(function(e){return e.dataset["bbZone"+t.zoneLevel]===t.name}).length<1)return this.violated("Did not find required click zone "+this.zoneLevel+" with value "+this.name+" in DOM!")}},{key:"describe",value:function(){return"Expect to find a click zone "+this.zoneLevel+" with value "+this.name+" in the DOM."}}]),r}(),ae=function(e){function o(e,t,n){X(this,o);var r=ee(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,"allowed-zones","DOM",n));return r.zoneLevel=e,r.zoneNames=t,r}return te(o,O),$(o,[{key:"test",value:function(){var t=this,e=void 0,n=new Set(this.zoneNames),r=[].concat(Q(c().dom.querySelectorAll("[data-bb-zone"+this.zoneLevel+"]"))).map(function(e){return e.dataset["bbZone"+t.zoneLevel]});return 0<(r=r.filter(function(e){return!n.has(e)})).length&&(e=this.violated("Found click zone "+this.zoneLevel+" with disallowed values ["+r.join()+"]! Valid values are ["+this.zoneNames.join()+"].")),e}},{key:"describe",value:function(){return"Expect that click zone "+this.zoneLevel+" only contains allowed values."}}]),o}();var ue=function(e){function r(e){return X(this,r),ee(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,(t=ne.map(function(e){return new ie(1,e)}).concat(re.map(function(e){return new ie(2,e)})),n=[new ae(1,ne),new ae(2,oe)],[].concat(t,n)),"required-click-zones-validator",function(){return!!e.dom}));var t,n}return te(r,R),r}();ue.allowedZone1=ne,ue.requiredZone1=ne,ue.allowedZone2=oe,ue.requiredZone2=re,ue.RequiredZoneRule=ie,ue.RestrictedZoneRule=ae;var ce=ue,se=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function le(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var fe=function(e){function i(e,t,n){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var o=le(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,c().getFirstPageViewEvent(),function(){return[new W(e,t,n),R.create(c(),[new ce.RequiredZoneRule(3,"main-product-info"),new ce.RequiredZoneRule(4,"product-image"),new ce.RequiredZoneRule(4,"product-heading"),new ce.RequiredZoneRule(3,"reviews"),new ce.RequiredZoneRule(3,"vendor-block")],"product-page-dom",function(){return!0})]},"product-page"));return le(r=o,r)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,R.ChainedValidator),se(i,[{key:"validate",value:function(){return console.log("product-page-validator: Performing validation..."),function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0}(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"validate",this).call(this)}},{key:"shouldBeApplied",value:function(){var e=c().getFirstPageViewEvent();return"detail"===e.bbPageType&&"product"===e.bbPageSubType}}]),i}(),pe=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();var he={productClick:{eventNames:new Set(["productClick"]),requiredProps:new Set(["products"]),Validator:W},impressions:{eventNames:new Set([]),requiredProps:new Set([]),Validator:W},"product-detail":{eventNames:new Set(["product-detail"]),requiredProps:new Set(["products"]),Validator:fe},"add-to-cart":{eventNames:new Set(["add-to-cart"]),requiredProps:new Set(["products"]),Validator:W},"remove-from-cart":{eventNames:new Set(["remove-from-cart"]),requiredProps:new Set(["products"]),Validator:W},checkout:{eventNames:new Set(["checkout"]),requiredProps:new Set(["products"]),Validator:W,actionField:{requiredProps:new Set(["step","option"])}},checkout_option:{eventNames:new Set(["checkoutOption"]),requiredProps:new Set(["actionField"]),Validator:W,actionField:{requiredProps:new Set(["step","option"])}},purchase:{eventNames:new Set(["purchase"]),requiredProps:new Set(["actionField","products"]),Validator:W,actionField:{requiredProps:new Set(["id","revenue","shipping","tax"])}},refund:{eventNames:new Set([]),requiredProps:new Set([]),Validator:W},promoView:{eventNames:new Set([]),requiredProps:new Set(["promotions"]),Validator:W},"promotion-impression":{eventNames:new Set([]),requiredProps:new Set(["promotions"]),Validator:W},promoClick:{eventNames:new Set(["promotionClick"]),requiredProps:new Set(["promotions"]),Validator:W}},ve=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,c(),function(){var e=c(),t=[new O.RequiredRule("currencyCode","ecommerce")],o=[R.create(e.getFinalizedDataLayer(),t,"ecommerce.basic",!0)];return e.getEnhancedEcommerceEvents().forEach(function(e,t){var n=he[e.event];if(n){var r=new n.Validator(e.event+"["+t+"]",e,n);o.push(r)}}),o.slice(0)},"enhancedEcommerceSuite"))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,R.ChainedValidator),pe(t,[{key:"shouldBeApplied",value:function(){return this.sourceObject.ecommerce}},{key:"validate",value:function(){return function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"validate",this).call(this)}}]),t}(),de=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();var be=function(e){function o(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{rules:[]},r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,r,function(){var t=[];return Object.keys(n).forEach(function(e){"rules"===e?t=t.concat(n[e]):r.bbPageSubType===e&&n[e].rules&&(t=t.concat(n[e].rules))}),[R.create(r,t,"bbPageType."+e,!0)]},e));return t.config=n,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,R.ChainedValidator),de(o,[{key:"shouldBeApplied",value:function(){return!0}}]),o}(),ye=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();var ge=new Set(["detail","checkout"]),me={marketing:{rules:[],Top10Page:{rules:[]},Top50Page:{rules:[]},CampaignPage:{rules:[]},CampaignPageSidebars:{rules:[]},Unknown:{rules:[]}},detail:{rules:[new O.RestrictKeyRule(["product",void 0],"bbPageSubType")],product:{rules:[new O.RequiredRule("detail","ecommerce")]}},list:{rules:[new O.RestrictKeyRule(["category","search","product","sku",void 0],"bbPageSubType")],search:{rules:[new O.RequiredRule("bbNumSearchResults"),new O.RequiredRule("searches"),new O.RequiredRule("searchTerm")]}},profile:{rules:[new O.RestrictKeyRule(["display","user"],"bbPageSubType")]},checkout:{rules:[new O.RestrictKeyRule(["flow","receipt","step"],"bbPageSubType")]},settings:{rules:[]}},we=function(e){function i(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var e=c(),t=e.getFirstPageViewEvent(),n=e.getFinalizedDataLayer(),r=e.getFirstPageViewEvent().bbPageType,o=e.getFirstPageViewEvent().bbPageName;return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,function(){var e=[new O.RestrictKeyRule(Object.keys(me),"bbPageType")];return ge.has(r)&&"order-status"!=o&&e.push(new O.RequiredRule("ecommerce")),[new be("bbPageType",me[t.bbPageType],t),R.create(n,e,"storeCore",!0),new ve(t)]},"store-page-validator"))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,R.ChainedValidator),ye(i,[{key:"shouldBeApplied",value:function(){return"store"===(this.sourceObject.bbPageSiteSection||"").trim().toLowerCase()}}]),i}(),_e=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function Oe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Pe(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ke(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var je=["bbContentType","bbContentTemplate"].map(function(e){return new O.RequiredRule(e)}),Ee=["bbArticleTitle","bbArticleCategory","bbArticleRatingCount","bbArticleRating","bbContentAuthor","bbContentPublishDate","bbContentModifiedDate"].map(function(e){return new O.RequiredRule(e)}),Re=["article","exercises","coach","workout-plan","recipe","landing-page","all-access"],Se=new Set(["list","home","landing"]),xe=function(e){function t(){return Oe(this,t),Pe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,c().getFirstPageViewEvent(),je.concat([new O.RestrictKeyRule(Re,"bbContentType")]),"content-detail-page",function(){return"content"===c().getFirstPageViewEvent().bbPageSiteSection&&!Se.has(c().getFirstPageViewEvent().bbPageType)}))}return ke(t,R),t}(),qe=new Set(["article","recipe"]),Ce=function(e){function t(){return Oe(this,t),Pe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,c().getFirstPageViewEvent(),Ee,"published-content",function(){return qe.has(c().getFirstPageViewEvent().bbContentType)}))}return ke(t,R),t}(),Ve=function(e){function n(){var e;Oe(this,n);var t=Pe(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,c(),function(){return[new xe,new Ce]},"content"));return Pe(e=t,e)}return ke(n,R.ChainedValidator),_e(n,[{key:"shouldBeApplied",value:function(){return"content"===c().getFirstPageViewEvent().bbPageSiteSection}}]),n}(),Te=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function Ae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Le(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Ne(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var ze=function(e){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Ae(this,n);var t=Le(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,[new O.RequiredRule("bbEvent.event"),new O.RequiredRule("bbEvent.category"),new O.RequiredRule("bbEvent.action"),new O.RequiredRule("bbEvent.label"),new O.RequiredRule("bbEvent.fields.bbZone1"),new O.RequiredRule("bbEvent.fields.bbZone2"),new O.StringMatchesRule(/^(?!(link|button|select|checkbox|radio|file|)\.click).*/,"bbEvent.event")],"click",!0));return e.bbEvent&&e.bbEvent.fields&&e.bbEvent.fields.bbZone4&&t.rules.push(new O.RequiredRule("bbEvent.fields.bbZone3")),t}return Ne(n,R),n}(),Ue=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return Ae(this,t),Le(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,function(){var t=[];return e.forEach(function(e){"bbEvent.click"===e.event&&t.push(new ze(e))}),t},"bbEventValidator"))}return Ne(t,R.ChainedValidator),Te(t,[{key:"shouldBeApplied",value:function(){return!0}}]),t}(),Fe=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function De(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ie(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Me(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var Be=["lgn","p_web_lgn","c","DYN_USER_CONFIRM","DYN_USER_ID","elm","jessionID","jsessionID","lc","bb_ui_flash_message"],Ke=["_gid","gpv_pn","m","commerceItemCount","mobilePreference","userPrefLanguage","UserPrefLanguage","goneNative","_ga","_gat","Firebase","optimizelyBuckets","optimizelyEndUserId","optimizelyPendingLogEvents","optimizelySegments","s_cc","s_fid","s_invisit","s_lv","s_lv_s","s_nr","s_prop_14","s_vi","s_vnum","v13","v62","v63","v66","s_ppv","s_sq","AdobeMobileSDK","_insp_nv","insp_slim","insp_targ|pt","insp_targ|pu","insp_wid","_insp_norec_howoften"],Ze=["_gads","atuvs","cd_gtm_UA-55035870-1","_dc_gtm_UA-55035870-1"],He=function(e){function r(e,t){De(this,r);var n=Ie(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,"privacy-settings"));return n.cookieName=e,n}return Me(r,O),Fe(r,[{key:"test",value:function(){var e=void 0;if(c().hasCookie(this.name)){var t="Privacy setting "+this.name+" does not allow the setting cookie named "+this.cookieName;e=new s(this,t,{cookie:c().getCookie(this.cookieName),settingName:this.name})}return e}},{key:"describe",value:function(){return"Expect that cookie does not violate privacy setting "+this.name+"."}}]),r}();var Ge=function(e){function n(){return De(this,n),Ie(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,c().getFinalizedDataLayer(),(e=c().getFinalizedDataLayer().privacySettings,t=[new O.Not(new O.CookieRequiredRule("v1guid","cookies"))],e?(e.necessary||Be.forEach(function(e){return t.push(new He(e,"necessary"))}),e.experience||Ke.forEach(function(e){return t.push(new He(e,"experience"))}),e.social||Ze.forEach(function(e){return t.push(new He(e,"social"))})):t.push(new O.CookieRequiredRule("m")),t)));var e,t}return Me(n,R),Fe(n,[{key:"shouldBeApplied",value:function(){return!0}}]),n}(),Ye=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();var Je=function(e){function n(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e.privacySettings||{},(t=[],["experience","social","necessary"].forEach(function(e){t.push(new O.RestrictKeyRule(new Set([!0,!1]),e))}),t)));var t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,R),Ye(n,[{key:"shouldBeApplied",value:function(){return!0}}]),n}(),We=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function $e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Qe(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Xe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var et=new Set(["product-detail","checkout","purchase","remove-from-cart","measurement.start"]),tt=function(e){function t(){return $e(this,t),Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"pageview is first event","Events"))}return Xe(t,O),We(t,[{key:"test",value:function(){for(var e=void 0,t=c().events,n=[],r=void 0,o=0;o<t.length;o++){var i=t[o];if("gtm.js"===i.event&&(r=i),r)break;et.has(i.event)||n.push(i)}return 0<n.length&&(e=this.violated("Events ["+n.map(function(e){return e.event}).join(", ")+'] happened before the pageview event "gtm.js"!',{earlyEvents:n})),e}},{key:"describe",value:function(){return'Events should only fire after the pageview event "gtm.js".'}}]),t}(),nt=function(e){function t(){return $e(this,t),Qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,c(),[new tt],"events-validator",!0))}return Xe(t,R),t}(),rt=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),ot=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0};function it(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function at(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ut(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var ct=function(e){function r(e,t,n){return it(this,r),at(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,[new O.RequiredRule("name"),new O.RequiredRule("creative"),new O.RequiredRule("position")],t+"-internal-promo-validator-"+n,function(){return!0}))}return ut(r,R),rt(r,[{key:"validate",value:function(){return ot(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"validate",this).call(this)}}]),r}(),st=function(e){function t(){return it(this,t),at(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,c(),function(){var r=[],t=c().filterEvents(function(e){return"promotionClick"===e.event}),o=c().filterEvents(function(e){return"promotion-impression"===e.event}),i=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(c().dom.querySelectorAll("[data-bb-impression]"))).filter(function(e){return e.dataset.bbImpression.match(/.*promotion.*/)});return t.forEach(function(e,n){r.push(R.create(e,[new O.RequiredRule("eventLabel"),new O.RequiredRule("ecommerce"),new O.RequiredRule("promoClick","ecommerce")],"promoClick"+n+"-event-validator",!0),R.create(e.ecommerce.promoClick,[new O.RequiredRule("brand"),new O.RequiredRule("promotions"),"promoClick"+n+"-ecommerce-validator",!0])),e.ecommerce&&e.ecommerce.promoClick&&e.ecommerce.promoClick.promotions&&e.ecommerce.promoClick.promotions.forEach(function(e,t){r.push(new ct(e,"promoClick["+n+"]",""+t))})}),o.forEach(function(e,n){r.push(R.create(e,[new O.RequiredRule("eventLabel"),new O.RequiredRule("ecommerce"),new O.RequiredRule("promoView","ecommerce"),O.custom(function(){var e=void 0;return i.length!==o.length&&(e=new s(this,"Expected "+i.length+" internal promotion impressions but there were "+o.length+"!",{expectedImpressions:i.length,actualImpressions:o.length})),e},"All impression events on page fired"),O.custom(function(){var e=void 0;return t.length>o.length&&(e=new s(this,"Expected fewer internal promotion impression clicks than impressions! Click count was "+t.length+" but there were "+o.length+" impressions!")),e},"All impression events on page fired")],"promoView"+n+"-event-validator",!0),R.create(e.ecommerce.promoView,[new O.RequiredRule("promotions")],"promoView"+n+"-ecommerce-validator",!0)),e.ecommerce&&e.ecommerce.promoView&&e.ecommerce.promoView.promotions&&e.ecommerce.promoView.promotions.forEach(function(e,t){r.push(new ct(e,"promoView["+n+"]",""+t))})}),r},"internal-promo-event-validator"))}return ut(t,R.ChainedValidator),rt(t,[{key:"shouldBeApplied",value:function(){return!!(0<c().getEnhancedEcommerceEvents().length&&(c().hasEvent("promotion-impression")||c().hasEvent("promotionClick")))}},{key:"validate",value:function(){return ot(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"validate",this).call(this)}}]),t}(),lt={InternalPromoValidator:ct,InternalPromoEventValidator:st},ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pt=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function ht(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var vt=lt.InternalPromoEventValidator,dt=new(function(e){function t(){return ht(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"max-noscript-url","noscript","",O.severities.error))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,O),pt(t,[{key:"test",value:function(){var e=void 0;function i(r){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",e="";return"object"===(void 0===r?"undefined":ft(r))&&(e+=Object.keys(r).map(function(e){var t=r[e];if("object"===(void 0===t?"undefined":ft(t)))return i(t,e);var n=e;return o&&"string"==typeof o&&(n=o+"."+e),n+"="+t}).join("&")),e}try{for(var t=c(),n=0;n<t.length;n++){var r=t[n],o=i(r);if(8192<o.length){e=this.violated("Item in dataLayer with length of "+o.length+" exceeds maximum url length of 8192 for noscript iframe.",{value:r});break}}}catch(e){console.log("RootValidator: No dataLayer or no window object...")}return e}}]),t}()),bt=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";ht(this,r),this.context=c(e,t,n),this.dataLayer=e,this.mergedDataLayer=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],n={};try{e||(e=window.dataLayer),e||(console.log("No datalayer!"),e=[]),e.forEach(function(t){Object.keys(t).forEach(function(e){return n[e]=t[e]})})}catch(e){console.error("Not running in browser! You must provide the dataLayer argument!")}return n}(e),this.validators=[new q(this.context.getFirstPageViewEvent()),new N(this.context.getFinalizedDataLayer()),new we,new Ve(this.context.getFirstPageViewEvent()),new Ue(e),new Ge(this.context.getFinalizedDataLayer()),new Je(this.context.getFirstPageViewEvent()),new ce(this.context),new nt,new vt]}return pt(r,[{key:"ruleSet",value:function(){var e=this.validators.filter(function(e){return e.shouldBeApplied()}).map(function(e){return e.rules}).reduce(function(e,t){return e.concat(t)});return e.push(dt),this.rules=e,this.rules}},{key:"validate",value:function(){var e=this.validators.filter(function(e){return e.shouldBeApplied()}).map(function(e){return e.validate()}).reduce(function(e,t){return e.concat(t)}),t=dt.test(this.context.getDataLayerArray());return t&&e.push(t),e}}]),r}(),yt={validate:function(e,t,n){return new bt(e,t,n).validate()},rules:function(e,t,n){return new bt(e,t,n).ruleSet()},context:function(e,t,n){return c(e,t,n)},log:function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]&&arguments[3],o=new Set(yt.rules(e,t,n)),i=o.size,a=yt.validate(e,t,n),u={failure:"color:#F80;font-weight:bold;",error:"color:red;font-weight:bold;",skipped:"color:gray;font-weight:bold;",passed:"color:green;font-weight:bold;"};if(console.log("dlv:: %cData Layer Validation:","font-size: 120%; font-weight:bold;"),a.forEach(function(e){o.delete(e.rule),console.log("dlv::\t%c%s\t:\t%s - %s",u[e.rule.severity],e.rule.severity.toUpperCase(),e.rule.fqn,e.message)}),r){var c=new Set([]);o.forEach(function(e){var t=e.describe();c.has(t)||(c.add(t),console.log("dlv::\t%cSUCCESS\t:\t%s",u.passed,e.fqn,e.describe()))})}console.log("dlv:: %cTotals\tPassed:%d\tFailed:%d\tRules:%d","font-weight: bold;",o.size,a.length,i)}};try{window.dataLayerValidator=yt}catch(e){console.log("############## Not in browser...")}return yt}();